---
import EventManager from "../../components/EventManager";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { securityAudit } from "../../utils/securityAudit";

const audit = securityAudit(Astro.cookies, "admin");
if (!audit.authorized) {
  return Astro.redirect("/login");
}

const user = audit.session;
---

<BaseLayout title="Admin Ã©vÃ©nements">
  <h1>ğŸ”§ Gestion des Ã©vÃ©nements</h1>
  {user ? (
    <p>ConnectÃ© en tant que : {user.username} (rÃ´le : {user.role})</p>
  ) : (
    <p>Utilisateur non reconnu.</p>
  )}
  <EventManager initialEvents={Astro.props.events} client:only="preact" />
</BaseLayout>