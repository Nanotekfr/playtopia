---
import EventManager from "../../components/EventManager";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { securityAudit } from "../../utils/securityAudit";

export const prerender = false;

// VÃ©rifie la session et le rÃ´le admin
const audit = securityAudit(Astro.cookies, "admin");

if (!audit.authorized) {
  return Astro.redirect("/login");
}

const user = audit.user; // infos utilisateur depuis users.json
---

<BaseLayout title="Admin Ã©vÃ©nements">
  <h1>ğŸ”§ Gestion des Ã©vÃ©nements</h1>
  {user ? (
    <p>ConnectÃ© en tant que : {user.username} (rÃ´le : {user.role})</p>
  ) : (
    <p>Utilisateur non reconnu.</p>
  )}

  <EventManager initialEvents={Astro.props.events} client:only="preact" />
</BaseLayout>