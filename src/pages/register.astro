---
// src/pages/auth.astro
import { useState } from "preact/hooks";
import BaseLayout from "../layouts/BaseLayout.astro";
---
<BaseLayout>
    <h2>Inscription</h2>
    <form id="registerForm">
      <input type="text" name="username" placeholder="Username" required />
      <input type="email" name="email" placeholder="Email" required />
      <input type="password" name="password" placeholder="Password" required />
      <button type="submit">S'inscrire</button>
    </form>

    <h2>Connexion</h2>
    <form id="loginForm">
      <input type="text" name="identifier" placeholder="Email ou Username" required />
      <input type="password" name="password" placeholder="Password" required />
      <button type="submit">Se connecter</button>
    </form>

    <script type="module">
      const registerForm = document.getElementById('registerForm');
      const loginForm = document.getElementById('loginForm');

      registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(registerForm));
        const res = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
        const result = await res.json();
        alert(result.message || result.error);
      });

      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(loginForm));
        const res = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
        const result = await res.json();
        alert(result.message || result.error);
      });
    </script>
</BaseLayout>