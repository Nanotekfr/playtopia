---
import LoginForm from "../components/LoginForm";
import BaseLayout from "../layouts/BaseLayout.astro";
import { securityAudit } from "../utils/securityAudit";

export const prerender = false;

// VÃ©rifie si l'utilisateur est dÃ©jÃ  connectÃ©
const audit = securityAudit(Astro.cookies);

// Si une session valide existe et que le rÃ´le est admin, redirige vers /admin
if (audit.authorized && audit.user?.role === "admin") {
  return Astro.redirect("/admin");
}
---

<BaseLayout title="Connexion Admin">
  <div style="max-width: 600px; margin: 4rem auto; padding: 1rem;">
    <h1 style="text-align:center; margin-bottom:2rem;">ğŸ” Connexion Ã  lâ€™espace Admin</h1>

    <!-- Formulaire de connexion -->
    <LoginForm client:idle redirectUrl="/admin" />

    <p style="text-align:center; margin-top:1rem; font-size:0.9rem; color:gray;">
      Si vous nâ€™avez pas de compte, contactez lâ€™administrateur.
    </p>
  </div>
</BaseLayout>